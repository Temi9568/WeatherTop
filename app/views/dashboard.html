#{extends "main.html" /}
#{set title:"Dashboard" /}

#{menu id:"dashboard"/}

#{list items:member.stations, as:'station'}
<div class="content box">
    <div class="station header">
        <h1 class="title is-danger" style="display: inline-block;">${station.name}</h1>
        <form action="/dashboard/deleteStation/${station.id}" method="POST" style="float: right;">
            <div class="field">
                <div class="control">
                    <button class="button is-link is-danger" type="submit">Delete ${station.name}</button>
                </div>
            </div>
        </form>
    </div>

<!--    STATION SUMMARY PANES-->
    <div class="columns">
        <div class="column">
            <div class="notification is-dark" style="height:100%">
                <p><b>${station.name}</b></p>
                <p style="margin:0">Lat: ${station.Lat}</p>
                <p style="margin:0">Lng: ${station.Lng}</p>
            </div>
        </div>

        <div class="column">
            <div class="notification is-dark" style="height:100%">
                <p><b>Weather</b></p>
                <p>${station.weather}</p>
            </div>
        </div>
        <div class="column">
            <div class="notification is-dark" style="height:100%">
                <p><b>Temp</b></p>
                <p style="margin:0">${station.tempC}C</p>
                <p style="margin:0">${station.tempF}F</p>
                <p style="margin:0">Max: ${station.max}</p>
                <p style="margin:0; display: inline">Min: ${station.min}</p>
                    %{ if (station.min < station.max) { }%
                        <span class="icon is-large has-text-danger" style="display: inline; float: right;">
                            <i class="fa-solid fa-arrow-trend-down fa-2x"></i>
                        </span>
                    %{ } else { }%
                        <span class="icon is-large has-text-success" style="display: inline; float: right;">
                            <i class="fa-solid fa-arrow-trend-up fa-2x"></i>
                        </span>
                    %{ } }%
            </div>
        </div>
        <div class="column">
            <div class="notification is-dark" style="height:100%">
                <p style="margin:0"><b>Wind</b></p>
                <p></p>
                <p style="margin:0">${station.windBFT}bft</p>
                <p style="margin:0">${station.windDirection}</p>
                <p style="margin:0">Feels like</p>
                <p style="margin:0">${station.windChill}</p>
                <p style="margin:0">Max: ${station.windMax}</p>
                <p style="margin:0;display: inline;">Min: ${station.windMin}</p>
                %{ if (station.windMin < station.windMax) { }%
                <span class="icon is-large has-text-danger" style="display: inline; float: right;">
                            <i class="fa-solid fa-arrow-trend-down fa-2x"></i>
                        </span>
                %{ } else { }%
                <span class="icon is-large has-text-success" style="display: inline; float: right;">
                            <i class="fa-solid fa-arrow-trend-up fa-2x"></i>
                        </span>
                %{ } }%
            </div>
        </div>
        <div class="column">
            <div class="notification is-dark" style="height:100%">
                <p><b>Pressure</b></p>
                <p style="margin:0">${station.pressure} hpa</p>
                <p style="margin:0">Max: ${station.pressureMax}</p>
                <p style="margin:0; display: inline;">Min: ${station.pressureMin}</p>
                %{ if (pressureMin < pressureMax) { }%
                <span class="icon is-large has-text-danger" style="display: inline; float: right;">
                            <i class="fa-solid fa-arrow-trend-down fa-2x"></i>
                        </span>
                %{ } else { }%
                <span class="icon is-large has-text-success" style="display: inline; float: right;">
                            <i class="fa-solid fa-arrow-trend-up fa-2x"></i>
                        </span>
                %{ } }%
            </div>
        </div>
    </div>

    <div>
        <span class="icon is-large collapse-icon">
                <i class="fa-regular fa-square-minus fa-2x"></i>
            </span>
    </div>


<!--    READINGS TABLE-->
    <table class="readings-table">
        <thead>
        <tr>
            <th>Date/Time</th>
            <th>Code</th>
            <th>Temp</th>
            <th>Wind Speed</th>
            <th>Wind Direction</th>
            <th>Pressure</th>
            <th></th> <!--            will be used for submit button-->
        </tr>
        </thead>

        <tbody>
        #{list items:station.readings, as:'reading'}
        <tr>
            <td>${reading.date}</td>
            <td>${reading.code}</td>
            <td>${reading.temperature}</td>
            <td>${reading.windSpeed}</td>
            <td>${reading.windDirection}</td>
            <td>${reading.pressure}</td>
            <td>
                <form action="/dashboard/deleteReading/${station.id}/${reading.id}" method="POST">
                    <div class="field">
                        <div class="control">
                            <button class="button is-link is-danger" type="submit">Delete</button>
                        </div>
                    </div>
                </form>
            </td>
        </tr>
        #{/list}
        <tr>
        <form action="/dashboard/${station.id}/addReading" method="POST">
<!--            <input type="hidden" name="id" value=${station.id}>-->
            <td>
                <div class="field">
                    <!--                <label class="label">Code</label>-->
                    <div class="control">
                        <input class="input" name="code" placeholder="" disabled>
                    </div>
                </div>
            </td>
            <td>
            <div class="field">
<!--                <label class="label">Code</label>-->
                <div class="control">
                    <input class="input" name="code" placeholder="00">
                </div>
            </div>
            </td>
            <td>
            <div class="field">
<!--                <label class="label">Temperature</label>-->
                <div class="control">
                    <input class="input" name="temperature" placeholder="00.0C">
                </div>
            </div>
            </td>
            <td>
            <div class="field">
<!--                <label class="label">Wind Speed</label>-->
                <div class="control">
                    <input class="input" name="windSpeed" placeholder="00.00kMh">
                </div>
            </div>
            </td>
            <td>
            <div class="field">
<!--                <label class="label">Wind Direction</label>-->
                <div class="control">
                    <input class="input" name="windDirection" placeholder="000deg">
                </div>
            </div>
            </td>
            <td>
            <div class="field">
<!--                <label class="label">Pressure</label>-->
                <div class="control">
                    <input class="input" name="pressure" placeholder="000hPa">
                </div>
            </div>
            </td>
            <td>
            <div class="field">
                <div class="control">
                    <button class="button is-link is-success" type="submit">Submit Report</button>
                </div>
            </div>
            </td>
        </form>
        </tr>
        </tbody>
    </table>
    <div class="box">

    </div>
</div>
#{/list}

<div class="content box">
    <form id="addStation" action="/dashboard/addStation" method="POST" onsubmit="return validateForm(event)">
        <div class="columns is-multiline">
            <div class="column is-one-third">
                <div class="field">
                    <label id="addStationName" class="label title" style="font-size: 1.5em;">Name</label>
                    <div class="control">
                        <input class="input is-normal" type="text" name="name" placeholder="Name">
                    </div>
                </div>
            </div>

            <div class="column is-one-third">
                <div class="field">
                    <label class="label title" style="font-size: 1.5em;">Lat</label>
                    <div class="control">
                        <input class="input is-normal" type="text" name="lat" id="latInput" placeholder="00.00">
                    </div>
                </div>
            </div>

            <div class="column is-one-third">
                <div class="field">
                    <label class="label title" style="font-size: 1.5em;">Lng</label>
                    <div class="control">
                        <input class="input is-normal" type="text" name="lng" id="lngInput" placeholder="00.00">
                    </div>
                </div>
            </div>
        </div>

        <div class="field">
            <div class="control">
                <button class="button is-link is-info is-normal">Add Station</button>
            </div>
        </div>
    </form>
</div>


<script>
    const icons = document.querySelectorAll(".collapse-icon");
    const tables = document.querySelectorAll(".readings-table");

    for (let i=0;  i < icons.length; i++) {
        icons[i].addEventListener('click', () => {
            if (tables[i].classList.contains('collapsed')) {
                tables[i].style.display = "table";
                icons[i].innerHTML = '<i class="fa-regular fa-square-minus fa-2x"></i>';
            } else {
                tables[i].style.display = "none";
                icons[i].innerHTML = '<i class="fa-regular fa-square-plus fa-2x"></i>';
            }

            tables[i].classList.toggle('collapsed');
        });
    }









    // function validateForm(event) {
    //     event.preventDefault(); // Stops default form submit behaviour
    //
    //     // AddStation Form - Validation
    //     if (event.target.id === "addStation") {
    //         var name = document.getElementById("addStationName").value;
    //         var lat = parseFloat(document.getElementById("latInput").value);
    //         var lng = parseFloat(document.getElementById("lngInput").value);
    //         if (isNaN(lat) || isNaN(lng)) {
    //             alert("Please enter valid latitude and longitude values.");
    //             return false;
    //         } else if (name.length <= 0) {
    //             alert("The station name you entered is invalid.")
    //             return false;
    //         }
    //     }
    //     // TODO - REALISTICALLY ADD SOME REGEX FOR THESE TBH, MANUAL VALIDATION IS POINTLESS
    //     event.target.submit();
    // }
</script>

